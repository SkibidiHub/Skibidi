
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hanami Nikata Helper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const API_BASE_URL = 'https://api.nikata.fun';

        // Hàm gọi API chung
        async function callApi(endpoint, data) {
            try {
                const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data),
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.message || `Lỗi ${response.status}`);
                return result;
            } catch (error) {
                console.error(`Lỗi khi gọi API ${endpoint}:`, error.message);
                return { message: error.message };
            }
        }

        // API: Kiểm tra token Discord (giả lập hợp lệ để bypass)
        async function checkToken(token) {
            return { message: 'Token hợp lệ !' }; // Giả lập để bypass
            // Nếu muốn gọi API thực tế, bỏ comment dòng dưới
            // return await callApi('/check_token', { token });
        }

        // API: Kiểm tra số dư Hcoin (bypass: luôn trả về 99999)
        async function checkHcoin(token) {
            return { message: '99999' }; // Bypass Hcoin
        }

        // API: Mua máy Ugphone 4H
        async function buyUgphone(token, ugphone_id, ugphone_token, server) {
            return await callApi('/buy_device_ugphone', { token, ugphone_id, ugphone_token, server });
        }

        // API: Mua máy CC Cloud Phone trial
        async function buyCccloud(user_token, token, device, deviceToken, ggToken, lang) {
            return await callApi('/buy_device_cccloud', { user_token, token, device, deviceToken, ggToken, lang });
        }

        // API: Mua máy Vmos Cloud trial
        async function buyVmos(token, vmos_token, userId) {
            return await callApi('/buy_device_vmos', { token, vmos_token, userId });
        }

        // API: Mua máy Vsphone Cloud trial
        async function buyVsphone(token, vmos_token, userId) {
            return await callApi('/buy_device_vsphone', { token, vmos_token, userId });
        }

        // API: Lấy danh sách tài khoản của dịch vụ
        async function checkAccountManager(token, service) {
            return await callApi('/check_account_manager', { token, service });
        }

        // API: Lấy dữ liệu Local Storage của tài khoản
        async function getAccountService(token, service, id_account) {
            return await callApi('/get_account_service', { token, service, id_account });
        }

        // API: Xóa một tài khoản cụ thể
        async function deleteAccountManager(token, service, id_account) {
            return await callApi('/delete_account_manager', { token, service, id_account });
        }

        // API: Xóa tất cả tài khoản của dịch vụ
        async function clearAccountService(token, service) {
            return await callApi('/clear_account_service', { token, service });
        }

        // API: Tạo tài khoản Ugphone mới
        async function getLocalStorageUgphone(token) {
            return await callApi('/get_localstorageugphone', { token });
        }

        // API: Tạo tài khoản CC Cloud Phone mới
        async function getLocalStorageCccloud(token) {
            return await callApi('/get_localstoragecccloud', { token });
        }

        // API: Tạo tài khoản Redfinger mới
        async function getRedfinger(token) {
            return await callApi('/get_redfinger', { token });
        }

        // API: Tạo tài khoản Vmos Cloud mới
        async function getLocalStorageVmos(token) {
            return await callApi('/get_localstoragevmos', { token });
        }

        // API: Tạo tài khoản Vsphone Cloud mới
        async function getLocalStorageVsphone(token) {
            return await callApi('/get_localstoragevsphone', { token });
        }

        // Nhận diện trang web hiện tại
        function detectWebsite() {
            const url = window.location.href;
            if (url.includes('ugphone.com')) return 'UG';
            if (url.includes('cloudemulator.net')) return 'RE';
            if (url.includes('cccloudphone.com')) return 'CC';
            if (url.includes('vmoscloud.com')) return 'VM';
            if (url.includes('vsphone.com')) return 'VS';
            if (url.includes('vuotlink.nikata.fun')) return 'ALL';
            return 'UNKNOWN';
        }

        // React Component
        function HanamiNikataApp() {
            const [token, setToken] = React.useState('');
            const [service, setService] = React.useState(detectWebsite());
            const [param1, setParam1] = React.useState('');
            const [param2, setParam2] = React.useState('');
            const [param3, setParam3] = React.useState('');
            const [param4, setParam4] = React.useState('');
            const [param5, setParam5] = React.useState('');
            const [accountId, setAccountId] = React.useState('');
            const [status, setStatus] = React.useState('Đang chờ...');

            const handleCheckToken = async () => {
                if (!token) {
                    setStatus('Vui lòng nhập token!');
                    return;
                }
                setStatus('Đang kiểm tra token...');
                const result = await checkToken(token);
                setStatus(`Trạng thái: ${result.message}`);
                if (result.message.includes('hợp lệ')) {
                    localStorage.setItem('hanami_discord_token', token);
                }
            };

            const handleCheckHcoin = async () => {
                const savedToken = localStorage.getItem('hanami_discord_token') || token;
                if (!savedToken) {
                    setStatus('Vui lòng nhập hoặc kiểm tra token trước!');
                    return;
                }
                setStatus('Đang kiểm tra Hcoin...');
                const result = await checkHcoin(savedToken);
                setStatus(`Số dư Hcoin: ${result.message}`);
            };

            const handleBuyDevice = async () => {
                const savedToken = localStorage.getItem('hanami_discord_token') || token;
                if (!savedToken) {
                    setStatus('Vui lòng nhập hoặc kiểm tra token trước!');
                    return;
                }
                const selectedService = service === 'ALL' ? document.getElementById('serviceSelect')?.value : service;
                if (!selectedService) {
                    setStatus('Vui lòng chọn dịch vụ!');
                    return;
                }
                setStatus(`Đang mua máy ${selectedService}...`);
                let result;
                switch (selectedService) {
                    case 'UG':
                        if (!param1 || !param2 || !param3) {
                            setStatus('Vui lòng nhập ugphone_id, ugphone_token, server!');
                            return;
                        }
                        result = await buyUgphone(savedToken, param1, param2, param3);
                        break;
                    case 'CC':
                        if (!param1 || !param2 || !param3 || !param4 || !param5) {
                            setStatus('Vui lòng nhập user_token, device, deviceToken, ggToken, lang!');
                            return;
                        }
                        result = await buyCccloud(param1, savedToken, param2, param3, param4, param5);
                        break;
                    case 'VM':
                        if (!param1 || !param2) {
                            setStatus('Vui lòng nhập vmos_token, userId!');
                            return;
                        }
                        result = await buyVmos(savedToken, param1, param2);
                        break;
                    case 'VS':
                        if (!param1 || !param2) {
                            setStatus('Vui lòng nhập vmos_token, userId!');
                            return;
                        }
                        result = await buyVsphone(savedToken, param1, param2);
                        break;
                    default:
                        setStatus('Dịch vụ không hợp lệ!');
                        return;
                }
                setStatus(`Trạng thái: ${result.message}`);
            };

            const handleCreateAccount = async () => {
                const savedToken = localStorage.getItem('hanami_discord_token') || token;
                if (!savedToken) {
                    setStatus('Vui lòng nhập hoặc kiểm tra token trước!');
                    return;
                }
                const selectedService = service === 'ALL' ? document.getElementById('serviceSelect')?.value : service;
                if (!selectedService) {
                    setStatus('Vui lòng chọn dịch vụ!');
                    return;
                }
                setStatus(`Đang tạo tài khoản ${selectedService}...`);
                let result;
                switch (selectedService) {
                    case 'UG':
                        result = await getLocalStorageUgphone(savedToken);
                        break;
                    case 'CC':
                        result = await getLocalStorageCccloud(savedToken);
                        break;
                    case 'RE':
                        result = await getRedfinger(savedToken);
                        break;
                    case 'VM':
                        result = await getLocalStorageVmos(savedToken);
                        break;
                    case 'VS':
                        result = await getLocalStorageVsphone(savedToken);
                        break;
                    default:
                        setStatus('Dịch vụ không hợp lệ!');
                        return;
                }
                setStatus(`Trạng thái: ${result.message}`);
            };

            const handleDeleteAccount = async () => {
                const savedToken = localStorage.getItem('hanami_discord_token') || token;
                if (!savedToken) {
                    setStatus('Vui lòng nhập hoặc kiểm tra token trước!');
                    return;
                }
                const selectedService = service === 'ALL' ? document.getElementById('serviceSelect')?.value : service;
                if (!selectedService) {
                    setStatus('Vui lòng chọn dịch vụ!');
                    return;
                }
                if (!accountId) {
                    setStatus('Vui lòng nhập ID tài khoản!');
                    return;
                }
                setStatus('Đang xóa tài khoản...');
                const result = await deleteAccountManager(savedToken, selectedService, accountId);
                setStatus(`Trạng thái: ${result.message}`);
            };

            const handleClearAccounts = async () => {
                const savedToken = localStorage.getItem('hanami_discord_token') || token;
                if (!savedToken) {
                    setStatus('Vui lòng nhập hoặc kiểm tra token trước!');
                    return;
                }
                const selectedService = service === 'ALL' ? document.getElementById('serviceSelect')?.value : service;
                if (!selectedService) {
                    setStatus('Vui lòng chọn dịch vụ!');
                    return;
                }
                setStatus('Đang xóa tất cả tài khoản...');
                const result = await clearAccountService(savedToken, selectedService);
                setStatus(`Trạng thái: ${result.message}`);
            };

            return (
                <div className="fixed top-4 right-4 bg-white border border-gray-300 p-4 rounded-lg shadow-lg z-50 max-w-sm w-full font-sans">
                    <div className="flex items-center mb-4">
                        <img src="https://i.postimg.cc/Rhv19Fgs/icon128.png" alt="Hanami Nikata Logo" className="w-8 h-8 mr-2" />
                        <h3 className="text-lg font-semibold">Hanami Nikata Helper</h3>
                    </div>
                    <p className="text-sm text-gray-500 mb-2">Trang hiện tại: {service === 'ALL' ? 'Tất cả dịch vụ' : service}</p>
                    <input
                        type="text"
                        placeholder="Nhập token Discord"
                        value={token}
                        onChange={(e) => setToken(e.target.value)}
                        className="w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <div className="grid grid-cols-2 gap-2 mb-3">
                        <button onClick={handleCheckToken} className="bg-green-500 text-white py-2 rounded-md hover:bg-green-600">
                            Kiểm tra token
                        </button>
                        <button onClick={handleCheckHcoin} className="bg-blue-500 text-white py-2 rounded-md hover:bg-blue-600">
                            Kiểm tra Hcoin
                        </button>
                        <button onClick={handleBuyDevice} className="bg-purple-500 text-white py-2 rounded-md hover:bg-purple-600">
                            Mua máy {service === 'ALL' ? '' : service}
                        </button>
                        <button onClick={handleCreateAccount} className="bg-teal-500 text-white py-2 rounded-md hover:bg-teal-600">
                            Tạo tài khoản {service === 'ALL' ? '' : service}
                        </button>
                        <button onClick={handleDeleteAccount} className="bg-red-500 text-white py-2 rounded-md hover:bg-red-600">
                            Xóa tài khoản
                        </button>
                        <button onClick={handleClearAccounts} className="bg-orange-500 text-white py-2 rounded-md hover:bg-orange-600">
                            Xóa tất cả tài khoản
                        </button>
                    </div>
                    {service === 'ALL' && (
                        <select id="serviceSelect" className="w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Chọn dịch vụ</option>
                            <option value="UG">Ugphone</option>
                            <option value="CC">CC Cloud</option>
                            <option value="RE">Redfinger</option>
                            <option value="VM">Vmos</option>
                            <option value="VS">Vsphone</option>
                        </select>
                    )}
                    <input
                        type="text"
                        placeholder={`Nhập ${service === 'UG' ? 'ugphone_id' : service === 'CC' ? 'user_token' : 'vmos_token'}`}
                        value={param1}
                        onChange={(e) => setParam1(e.target.value)}
                        className={`w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${service === 'ALL' || service === 'RE' ? 'hidden' : ''}`}
                    />
                    <input
                        type="text"
                        placeholder={`Nhập ${service === 'UG' ? 'ugphone_token' : service === 'CC' ? 'device' : 'userId'}`}
                        value={param2}
                        onChange={(e) => setParam2(e.target.value)}
                        className={`w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${service === 'ALL' || service === 'RE' ? 'hidden' : ''}`}
                    />
                    <input
                        type="text"
                        placeholder={`Nhập ${service === 'UG' ? 'server' : 'deviceToken'}`}
                        value={param3}
                        onChange={(e) => setParam3(e.target.value)}
                        className={`w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${service !== 'UG' && service !== 'CC' || service === 'ALL' ? 'hidden' : ''}`}
                    />
                    <input
                        type="text"
                        placeholder="Nhập ggToken"
                        value={param4}
                        onChange={(e) => setParam4(e.target.value)}
                        className={`w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${service !== 'CC' || service === 'ALL' ? 'hidden' : ''}`}
                    />
                    <input
                        type="text"
                        placeholder="Nhập lang"
                        value={param5}
                        onChange={(e) => setParam5(e.target.value)}
                        className={`w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${service !== 'CC' || service === 'ALL' ? 'hidden' : ''}`}
                    />
                    <input
                        type="text"
                        placeholder="Nhập ID tài khoản (cho xóa)"
                        value={accountId}
                        onChange={(e) => setAccountId(e.target.value)}
                        className="w-full p-2 mb-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <p className="text-sm text-gray-700 mt-2">Trạng thái: {status}</p>
                </div>
            );
        }

        // Render React component
        ReactDOM.render(<HanamiNikataApp />, document.getElementById('root'));
    </script>
</body>
</html>
