<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TempMail - Disposable Email Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Toast notification styles */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        .toast.success {
            background: #10b981;
        }
        .toast.error {
            background: #ef4444;
        }
        /* Email card hover effect */
        .email-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .email-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        /* Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 font-sans">
    <div class="container mx-auto p-4 sm:p-6 max-w-4xl">
        <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-4">TempMail</h1>
        <p class="text-center text-gray-600 mb-8">Generate disposable email addresses to keep your inbox spam-free.</p>

        <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
            <div class="flex flex-col sm:flex-row items-center gap-4">
                <input id="emailAddress" type="text" readonly class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Click 'Generate Email' to start">
                <button id="copyBtn" class="bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors">Copy</button>
            </div>
            <button id="generateBtn" class="mt-4 w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white px-4 py-3 rounded-lg hover:from-green-600 hover:to-emerald-600 transition-all flex items-center justify-center">
                <span id="generateText">Generate New Email</span>
                <span id="generateSpinner" class="spinner hidden ml-2"></span>
            </button>
        </div>

        <div id="inbox" class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Inbox</h2>
            <div id="emailList" class="space-y-4">
                <p class="text-gray-500 text-center">No emails yet.</p>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <script>
        const emailInput = document.getElementById('emailAddress');
        const copyBtn = document.getElementById('copyBtn');
        const generateBtn = document.getElementById('generateBtn');
        const generateText = document.getElementById('generateText');
        const generateSpinner = document.getElementById('generateSpinner');
        const emailList = document.getElementById('emailList');
        const toast = document.getElementById('toast');

        let currentToken = '';
        let isGenerating = false;

        // Show toast notification
        function showToast(message, type = 'success') {
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => {
                toast.className = 'toast';
            }, 3000);
        }

        // Fetch with retry
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        if (response.status === 429) throw new Error('Rate limit exceeded. Please try again later.');
                        throw new Error(`HTTP error: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    if (i < retries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }
                    throw error;
                }
            }
        }

        // Generate a new temporary email
        generateBtn.addEventListener('click', async () => {
            if (isGenerating) return;
            isGenerating = true;
            generateBtn.disabled = true;
            generateText.textContent = 'Generating...';
            generateSpinner.classList.remove('hidden');
            try {
                const data = await fetchWithRetry('https://api.tempmail.lol/v2/inbox/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prefix: `user${Math.floor(Math.random() * 10000)}` })
                });
                if (!data.address || !data.token) {
                    throw new Error('Invalid API response: Missing address or token');
                }
                emailInput.value = data.address;
                currentToken = data.token;
                emailList.innerHTML = '<p class="text-gray-500 text-center">No emails yet.</p>';
                showToast('Email generated successfully!', 'success');
                fetchEmails(data.token);
            } catch (error) {
                console.error('Error generating email:', error.message);
                showToast(`Failed to generate email: ${error.message}`, 'error');
            } finally {
                isGenerating = false;
                generateBtn.disabled = false;
                generateText.textContent = 'Generate New Email';
                generateSpinner.classList.add('hidden');
            }
        });

        // Copy email to clipboard
        copyBtn.addEventListener('click', () => {
            if (!emailInput.value) {
                showToast('No email to copy. Generate an email first.', 'error');
                return;
            }
            emailInput.select();
            document.execCommand('copy');
            showToast('Email copied to clipboard!', 'success');
        });

        // Fetch and display emails
        async function fetchEmails(token) {
            try {
                const emails = await fetchWithRetry(`https://api.tempmail.lol/v2/inbox/emails?token=${token}`, {});
                if (!emails || emails === undefined) {
                    emailList.innerHTML = '<p class="text-red-500 text-center">Inbox expired or invalid token. Generate a new email.</p>';
                    currentToken = '';
                    return;
                }
                if (emails.length === 0) {
                    emailList.innerHTML = '<p class="text-gray-500 text-center">No emails yet.</p>';
                    return;
                }
                emailList.innerHTML = '';
                emails.forEach(email => {
                    const emailDiv = document.createElement('div');
                    emailDiv.className = 'email-card bg-gray-50 p-4 rounded-lg shadow-sm';
                    emailDiv.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-semibold text-gray-800">From: ${email.from || 'Unknown'}</p>
                                <p class="text-gray-600">Subject: ${email.subject || 'No subject'}</p>
                            </div>
                            <p class="text-sm text-gray-500">${email.date ? new Date(email.date).toLocaleString() : 'Unknown date'}</p>
                        </div>
                        <p class="mt-2 text-gray-700">${email.body || 'No content'}</p>
                    `;
                    emailList.appendChild(emailDiv);
                });
            } catch (error) {
                console.error('Error fetching emails:', error.message);
                emailList.innerHTML = `<p class="text-red-500 text-center">Failed to fetch emails: ${error.message}</p>`;
            }
        }

        // Poll for new emails every 10 seconds
        setInterval(() => {
            if (currentToken) {
                fetchEmails(currentToken);
            }
        }, 10000);
    </script>
</body>
</html>
