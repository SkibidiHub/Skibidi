<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VMOS Cloud Phone</title>

  <!-- Vue 3, Axios, Element Plus -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/element-plus@2.3.14/dist/index.css">
  <script src="https://unpkg.com/element-plus@2.3.14/dist/index.full.min.js"></script>

  <style>
    body {margin:0;font-family:Inter,system-ui,Arial;background:#f5f7fb;color:#222;}
    .app{height:100vh;display:flex;flex-direction:column}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;background:#fff;border-bottom:1px solid #e6e9ef;box-shadow:0 1px 4px rgba(0,0,0,.06)}
    header .logo{font-weight:700;font-size:18px;color:#0079f2;}
    .main{flex:1;display:flex;gap:20px;padding:20px;overflow:hidden}
    .sidebar{width:320px;background:#fff;border-radius:12px;padding:16px;overflow:auto;border:1px solid #e7e9ef;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .device-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:10px;border:1px solid rgba(24,26,27,.06);margin-bottom:12px;cursor:pointer;transition:.2s}
    .device-item:hover{background:#f0f6ff}
    .device-item.active{background:rgba(0,121,242,0.08);border-color:#0079f2}
    .device-thumb{width:46px;height:78px;border-radius:6px;background:linear-gradient(135deg,#0079f2,#00c6ff);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .device-info{flex:1;min-width:0}
    .device-info .name{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .device-info .os{font-size:12px;color:#666;margin-top:4px}
    .canvas-wrap{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:16px}
    .phone-frame{width:400px;height:720px;border-radius:28px;border:14px solid #222;background:#000;overflow:hidden;position:relative;box-shadow:0 12px 30px rgba(0,0,0,.2)}
    canvas{display:block;width:100%;height:100%;background:#111}
    .actions{display:flex;gap:12px;margin-top:10px}
    .status{font-size:13px;color:#444;margin-top:8px}
    footer{padding:12px;text-align:center;font-size:12px;color:#888;border-top:1px solid #e6e9ef;background:#fafafa}
    .store-card{border:1px solid #e6e9ef;border-radius:10px;padding:16px;margin-bottom:12px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    .store-card h3{margin:0 0 8px 0;font-size:16px;color:#0079f2}
    .store-card p{margin:0 0 12px 0;font-size:13px;color:#555}
  </style>
</head>
<body>
  <div id="app" class="app"></div>

  <script>
  const { createApp, ref, onMounted } = Vue;

  createApp({
    template:`
      <div>
        <header>
          <div class="logo">☁️ VMOS Cloud Phone</div>
          <el-button type="primary" size="small" @click="showStore=true">Cửa hàng thiết bị</el-button>
        </header>

        <div class="main">
          <aside class="sidebar">
            <div style="font-weight:700;margin-bottom:10px">Danh sách thiết bị</div>
            <div v-for="d in devices" :key="d.deviceId" :class="['device-item',{active:selected && selected.deviceId===d.deviceId}]" @click="selectDevice(d)">
              <div class="device-thumb">VM</div>
              <div class="device-info">
                <div class="name">{{ d.name }}</div>
                <div class="os">ID: {{ d.deviceId }} · {{ d.os }}</div>
              </div>
            </div>
          </aside>

          <section class="canvas-wrap">
            <div class="phone-frame">
              <canvas ref="phoneCanvas" width="400" height="720"></canvas>
            </div>
            <div class="actions">
              <el-button type="primary" @click="startEmulator">Bắt đầu</el-button>
              <el-button @click="stopEmulator">Tắt</el-button>
              <el-button @click="restartEmulator">Khởi động lại</el-button>
            </div>
            <div v-if="status" class="status">Trạng thái: {{ status.status }} | Uptime: {{ status.uptime }}s</div>
          </section>
        </div>

        <el-dialog v-model="showStore" title="Cửa hàng thiết bị" width="500px">
          <div class="store-card" v-for="plan in storePlans" :key="plan.id">
            <h3>{{ plan.name }}</h3>
            <p>{{ plan.desc }}</p>
            <el-button type="primary" @click="buyPlan(plan)">{{ plan.button }}</el-button>
          </div>
        </el-dialog>

        <footer>
          VMOS Cloud Phone UI Demo · Mua đa thiết bị miễn phí hoặc nâng cấp · Vue3 + Element Plus
        </footer>
      </div>
    `,
    setup(){
      const backendUrl = "https://api.vmoscloud.com"; // thay URL thật nếu có
      const devices = ref([
        { deviceId:"emu-001", name:"Cloud Phone #1", os:"Android 11" }
      ]);
      const selected = ref(devices.value[0]);
      const status = ref(null);
      const phoneCanvas = ref(null);
      let ctx;

      const showStore = ref(false);
      const storePlans = ref([
        {id:1, name:"Thiết bị miễn phí", desc:"Thêm 1 Cloud Phone miễn phí (cơ bản)", button:"Thêm miễn phí"},
        {id:2, name:"Gói Pro (5 thiết bị)", desc:"Chạy cùng lúc 5 Cloud Phone với hiệu năng cao", button:"Mua Pro"},
        {id:3, name:"Gói Enterprise (10 thiết bị)", desc:"Cho doanh nghiệp, nhiều máy hơn", button:"Liên hệ"}
      ]);

      function selectDevice(d){ selected.value = d; }

      async function startEmulator(){
        if(!selected.value) return;
        try{
          await axios.post(`${backendUrl}/start`, { deviceId:selected.value.deviceId });
          const res = await axios.get(`${backendUrl}/status?deviceId=${selected.value.deviceId}`);
          status.value = res.data;
        }catch(e){ status.value = {status:"offline",uptime:0}; }
        drawScreen();
      }

      function stopEmulator(){
        status.value = null;
        ctx.fillStyle = "#111"; ctx.fillRect(0,0,400,720);
        ctx.fillStyle = "#fff"; ctx.fillText("Đã tắt",160,360);
      }

      function restartEmulator(){ stopEmulator(); setTimeout(startEmulator,300); }

      function drawScreen(){
        ctx.clearRect(0,0,400,720);
        const g = ctx.createLinearGradient(0,0,400,720);
        g.addColorStop(0,"#0079f2"); g.addColorStop(1,"#00c6ff");
        ctx.fillStyle = g;
        ctx.fillRect(0,0,400,720);
        ctx.fillStyle = "#fff"; ctx.font = "20px sans-serif";
        ctx.fillText("VMOS Cloud Phone",100,340);
        if(status.value) ctx.fillText("Uptime: "+status.value.uptime+"s",120,380);
      }

      function buyPlan(plan){
        if(plan.id===1){
          const id = "emu-"+Math.floor(Math.random()*9999);
          devices.value.push({ deviceId:id, name:"Cloud Phone #"+devices.value.length, os:"Android 12" });
          showStore.value=false;
        } else {
          alert("Bạn đã chọn: "+plan.name+" (demo)");
        }
      }

      onMounted(()=>{ ctx = phoneCanvas.value.getContext("2d"); stopEmulator(); });

      return {devices,selected,status,phoneCanvas,selectDevice,startEmulator,stopEmulator,restartEmulator,showStore,storePlans,buyPlan};
    }
  }).use(ElementPlus).mount("#app");
  </script>
</body>
</html>
