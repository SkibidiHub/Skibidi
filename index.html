<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Email 10 ph√∫t - Maildrop</title>
  <style>
    body{font-family:sans-serif;background:#f4f4f9;color:#333;margin:0;padding:0;display:flex;flex-direction:column;align-items:center}
    header{background:#4a90e2;color:#fff;width:100%;padding:1rem;text-align:center;font-size:1.4rem}
    .container{max-width:800px;width:100%;padding:1rem}
    .email-box{display:flex;justify-content:space-between;align-items:center;background:#fff;padding:.8rem 1rem;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
    button{background:#4a90e2;color:#fff;border:none;padding:.5rem 1rem;border-radius:5px;cursor:pointer;transition:.2s}
    button:hover{background:#357ABD}
    #mails{margin-top:1rem}
    .mail-card{background:#fff;margin:.5rem 0;padding:1rem;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);cursor:pointer}
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);justify-content:center;align-items:center}
    .modal-content{background:#fff;padding:1rem;max-width:600px;width:90%;border-radius:8px;max-height:80%;overflow:auto}
    .close{float:right;cursor:pointer;font-size:1.2rem}
  </style>
</head>
<body>
  <header>üìß Email 10 ph√∫t (Maildrop)</header>
  <div class="container">
    <div class="email-box">
      <span id="email">ƒêang t·∫°o...</span>
      <div>
        <button onclick="copyEmail()">üìã Copy</button>
        <button onclick="newEmail()">üîÑ T·∫°o m·ªõi</button>
      </div>
    </div>
    <p>‚è≥ H·∫øt h·∫°n sau: <span id="countdown">600</span>s</p>
    <h3>Inbox</h3>
    <div id="mails"></div>
  </div>

  <div id="modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <div id="mailContent"></div>
    </div>
  </div>

<script>
let emailUser="", countdown=600, timer, poller;

function randomName(len=6){
  const chars="abcdefghijklmnopqrstuvwxyz123456789";
  return Array.from({length:len},()=>chars[Math.floor(Math.random()*chars.length)]).join("");
}

function newEmail(){
  clearInterval(timer); clearInterval(poller);
  emailUser=randomName();
  document.getElementById("email").textContent=emailUser+"@maildrop.cc";
  countdown=600;
  document.getElementById("countdown").textContent=countdown;
  timer=setInterval(()=>{
    countdown--;
    document.getElementById("countdown").textContent=countdown;
    if(countdown<=0){
      clearInterval(timer);
      alert("Email h·∫øt h·∫°n, t·∫°o m·ªõi nh√©!");
    }
  },1000);
  poller=setInterval(loadInbox,10000);
  loadInbox();
}

function copyEmail(){
  navigator.clipboard.writeText(document.getElementById("email").textContent);
  alert("ƒê√£ copy email!");
}

async function loadInbox(){
  if(!emailUser) return;
  try{
    let res=await fetch(`https://maildrop.cc/api/inbox/${emailUser}`);
    let data=await res.json();
    let box=document.getElementById("mails");
    box.innerHTML="";
    if(data && data.emails && data.emails.length){
      data.emails.forEach(m=>{
        let div=document.createElement("div");
        div.className="mail-card";
        div.innerHTML=`<b>${m.from}</b><br>${m.subject||"(Kh√¥ng ti√™u ƒë·ªÅ)"}<br><small>${m.date}</small>`;
        div.onclick=()=>openMail(m.id);
        box.prepend(div);
      });
    }else{
      box.innerHTML="<i>Ch∆∞a c√≥ email</i>";
    }
  }catch(e){console.error("L·ªói load inbox:",e);}
}

async function openMail(id){
  try{
    let res=await fetch(`https://maildrop.cc/api/message/${emailUser}/${id}`);
    let data=await res.json();
    let content=document.getElementById("mailContent");
    content.innerHTML=`<h3>${data.subject}</h3><p><b>T·ª´:</b> ${data.from}</p><hr><div>${sanitize(data.body)}</div>`;
    document.getElementById("modal").style.display="flex";
  }catch(e){console.error("L·ªói m·ªü mail:",e);}
}

function sanitize(html){
  let div=document.createElement("div");
  div.textContent=html;
  return div.innerHTML.replace(/\n/g,"<br>");
}

function closeModal(){document.getElementById("modal").style.display="none";}

newEmail();
</script>
</body>
</html>
